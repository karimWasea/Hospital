@using hospitalUtilities

@model IEnumerable<hospitalVm.DoctorDayworkVM>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *,Cloudscribe.Web.Pagination

@{
    ViewData["Title"] = "SaveGET";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@*
<a asp-controller="TimingShifts" asp-action="Save">
    <i class="fas fa-plus-circle"></i> Add New TimingShifts
<h</a>*@
@*<h1>

@ViewBag.getdoctorfromapplicationuserid
</h1>
*@



<h1>jjj</h1>









<form  id="saveForm">
    <input type="hidden" id="hiddenId" name="id" value="@ViewBag.id" />

    <table class="table">
        <thead>
            <tr>
                <th>dayname</th>
                <th>StartingPmShift</th>
                <th>StratingAmShafit</th>
                <th>Checked Day</th>
                <th>AM Shift</th>
                <th>PM Shift</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var hospital in Model)
            {

                <tr>
                    <input type="hidden" id="chkCheckedDay_@hospital.DoctorId" asp-for="@hospital.DoctorId" haden />
                    <input type="hidden" id="chkCheckedDay_@hospital.WeekDaystId" asp-for="@hospital.WeekDaystId" haden />

                    <td>@hospital.dayname</td>
                    <td>@hospital.StartingPmShift</td>
                    <td>@hospital.StratingAmShafit</td>
                    <td>
                        <input type="checkbox" id="ischekedday" asp-for="@hospital.ischekedday" />

                    </td>
                    <td>
                        <input type="checkbox" id="isam" asp-for="@hospital.isam" />
                    </td>
                    <td>
                        <input type="checkbox" id="ispm" asp-for="@hospital.ispm" />
                    </td>
                    <td>
                        <a asp-controller="TimingShifts" asp-action="Save" asp-route-id="@hospital.DoctorId">
                            <i class="fas fa-edit" title="Edit"></i>
                        </a>
                        <a asp-controller="TimingShifts" asp-action="Delete" asp-route-id="@hospital.DoctorDayworkId">
                            <i class="fas fa-trash-alt" title="Delete"></i>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <button type="button" onclick="saveData()" class="btn btn-primary" style="width:150px">Save</button>
</form>
 
<script>

    function saveData() {
        const rows = document.querySelectorAll('tr');
        const data = [];

        rows.forEach(row => {
            const doctorId = row.querySelector('input[type="hidden"]').value;
            const ischekedday = row.querySelector('input#ischekedday').checked;
            const isam = row.querySelector('input#isam').checked;
            const ispm = row.querySelector('input#ispm').checked;

            data.push({
                DoctorId: doctorId,
                ischekedday: ischekedday,
                isam: isam,
                ispm: ispm
            });
        });
        alert('An error occurred while saving data.');

        const formData = JSON.stringify(data);
        alert(` com from ${formData}`);

        // Send data using AJAX
        fetch('/Doctor/Daywork/Save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                console.log('Response from server:', data);
                alert('Data saved successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving data.');
            });
    }
</script>
